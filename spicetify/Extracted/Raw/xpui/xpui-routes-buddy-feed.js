"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[4338],{68684:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Rn});var i=t(14942),r=t(59496),a=t(19391),s=t(21818),c=t(20409),o=t(22056),l=t(20225),u=t(15655),d=t(60750),f=t(90517),m=t(84797),v=t(46596),h=t(71544),g=t(26803),x=t(8566),b=t(13034),j=(t(78390),t(47408),t(74895)),p=(t(56404),t(95410),t(25750),t(3726),t(84875)),y=t.n(p),N=t(33892),k=t(47018),C=t(39836),S=t(74964),w=t(41001),E=t(33639),I=t(56080),L=t(42820),O=t(12340),D=t(3777),A=t(25280),T=t(21586),M=t(35407),F=t(89199),_=t(23351),P=t(68765),U=t(16020),B=t(75585),Z=t(95843),z=(t(54886),t(53903),function(e){if(!Number.isInteger(e))return"";var n=Date.now()-Number(e),t=Math.round(n/1e3/60),i=Math.round(n/1e3/60/60),r=Math.round(n/1e3/60/60/24),a=Math.round(n/1e3/60/60/24/7);return r>=7?o.ag.get("time.weeks.short",a):i>=24?o.ag.get("time.days.short",r):t>=60?o.ag.get("time.hours.short",i):t>0?o.ag.get("time.minutes.short",t):o.ag.get("time.now")}),R=t(4637),J=function(e){var n=e.timestamp;return e.isNowPlaying?(0,R.jsx)(Z.w,{label:o.ag.get("time.now"),children:(0,R.jsx)(B.h,{"aria-label":o.ag.get("time.now"),iconSize:16})}):(0,R.jsx)("span",{children:z(n)})};const Y="main-buddyFeed-friendActivity",H="SQHCRmgNjRywo1Lt7rP3",K="SCwzmMSXoZsmhGtGX81s",q="VLKqDIGaQn2bILzJKSZ0",W="main-buddyFeed-friendsFeedContainer",Q="main-buddyFeed-avatarContainer",V="main-buddyFeed-overlay",G="Irsd58UNEmDPxdhXKXCs",X="main-buddyFeed-activityMetadata",$="main-buddyFeed-usernameAndTimestamp",ee="main-buddyFeed-username",ne="main-buddyFeed-timestamp",te="main-buddyFeed-artistAndTrackName",ie="main-buddyFeed-playbackContextIcon",re="main-buddyFeed-playbackContext",ae="main-buddyFeed-playbackContextLink",se="main-buddyFeed-addFriendPlaceholder",ce="main-buddyFeed-addFriendPlaceholderBtn",oe="MObmOrMxbQpO10ebAtZA",le="cBPbfBWIIPDzhIT6i3ih",ue="PjDcsgAPmXlcTBJRGpIu",de="IRpPQFA57qgQ5jicWWaD",fe="Hm3nIbegLclY1uCAmnx_",me="bhRoVUHjWdo9mgUkU6fe",ve="BliqfY7vu_qE2C9zs5Ou",he="qdYWuHZd4HdSWfd4pSQB",ge="DhvYWKjDc7uyF3HfkDJJ",xe="ralK8s_OmE8a8zWcfNKM";var be=function(e){return Date.now()-e<9e5},je=function(e,n){var t;switch(null===(t=(0,k.EC)(e))||void 0===t?void 0:t.type){case k.JM.PLAYLIST:case k.JM.PLAYLIST_V2:return(0,R.jsx)(E.X,{uri:e});case k.JM.EPISODE:case k.JM.SHOW:return(0,R.jsx)(I.M,{uri:e});case k.JM.ALBUM:return(0,R.jsx)(S.Y,{uri:e,artistUri:n});case k.JM.ARTIST:return(0,R.jsx)(w.m,{uri:e});default:return null}},pe=function(e){switch(e){case k.JM.ALBUM:return U.p.ALBUM;case k.JM.ARTIST:return U.p.ARTIST;case k.JM.SHOW:return U.p.SHOW;case k.JM.EPISODE:return U.p.EPISODE;case k.JM.PLAYLIST:case k.JM.PLAYLIST_V2:return U.p.PLAYLIST;default:return}},ye=function(e){var n,t,i,a,s,c,l,u,d,f,m,h,g,x,j,p,S,E,I=e.show,U=void 0===I||I,B=e.spec,Z=e.friend,z=(0,r.useMemo)((function(){return Z.user.imageUrl?[{url:Z.user.imageUrl,width:0,height:0}]:[]}),[Z.user.imageUrl]),H=(0,v.o)(),K=(0,b.$P)(),q=Z.track,W=q.uri,se=null==q||null===(n=q.context)||void 0===n?void 0:n.uri,ce=(0,(0,P.n)({uri:se},{featureIdentifier:"buddy_feed",referrerIdentifier:"buddy_feed"}).usePlayContextItem)({uri:W}),oe=ce.togglePlay,le=ce.isPlaying,ue=ce.isActive,de=(0,k.EC)(null===(t=q.context)||void 0===t?void 0:t.uri),fe=null==de?void 0:de.type,me=(0,r.useCallback)((function(){oe(),H({intent:le?"pause":"play",type:"click",itemIdSuffix:"buddyfeed_play",targetUri:W});var e=B.friendRowFactory().playButtonFactory();ue?le?K.logInteraction(e.hitPause({itemToBePaused:W})):K.logInteraction(e.hitResume({itemToBeResumed:W})):K.logInteraction(e.hitPlay({itemToBePlayed:W}))}),[oe,H,le,W,B,ue,K]),ve=(0,r.useCallback)((function(e,n){K.logInteraction(B.friendRowFactory().friendRowLinkFactory({identifier:e}).hitUiNavigate({destination:n}))}),[K,B]),he=(0,T.O1)([W],q.name),ge=(0,T.O1)([null===(i=q.artist)||void 0===i?void 0:i.uri],null===(a=q.artist)||void 0===a?void 0:a.name),xe=(0,T.O1)([null===(s=q.context)||void 0===s?void 0:s.uri],null===(c=q.context)||void 0===c?void 0:c.name);return U?(0,R.jsxs)("div",{className:y()(Y),children:[(0,R.jsx)(M._,{menu:je(null===(l=q.context)||void 0===l?void 0:l.uri,null===(u=q.artist)||void 0===u?void 0:u.uri),children:(0,R.jsxs)("div",{className:Q,children:[(0,R.jsx)(C.q,{label:Z.user.name,width:40,userIconSize:16,images:z,withBadge:be(Z.timestamp)}),(0,R.jsx)(A.I,{className:V,iconClassName:G,isPlaying:le,isLocked:!1,onClick:me,playAriaLabel:le?o.ag.get("pause"):"".concat(o.ag.get("play")," ").concat(q.artist.name," ").concat(q.name)})]})}),(0,R.jsxs)("div",{className:y()(X),children:[(0,R.jsxs)("div",{className:$,children:[(0,R.jsx)(N.D,{as:"p",variant:"mestoBold",className:y()(ee,"ellipsis-one-line"),children:(0,R.jsx)(_.ZP,{value:"/buddyfeed_user_profile",children:(0,R.jsx)(M._,{menu:(0,R.jsx)(O.I,{uri:Z.user.uri}),children:(0,R.jsx)(D.Link,{title:Z.user.name,to:Z.user.uri,dir:"auto",onClick:function(){return ve("profile_link",Z.user.uri)},children:Z.user.name})})})}),(0,R.jsx)(N.D,{as:"p",variant:"finale",className:y()(ne),children:(0,R.jsx)(J,{timestamp:Z.timestamp,isNowPlaying:be(Z.timestamp)})})]}),(0,R.jsxs)(N.D,{as:"p",variant:"finale",className:te,children:[(0,R.jsx)(_.ZP,{value:"/buddyfeed_track",children:(0,R.jsx)(M._,{menu:(0,R.jsx)(L.$,{uri:q.uri,contextUri:null===(d=q.context)||void 0===d?void 0:d.uri,albumUri:null===(f=q.album)||void 0===f?void 0:f.uri,artists:[q.artist]}),children:(0,R.jsx)(D.Link,{title:q.name,to:W,className:"ellipsis-one-line",dir:"auto",draggable:!0,onDragStart:he,onClick:function(){return ve("track_link",W)},children:q.name})})}),(0,R.jsx)("span",{"aria-hidden":!0,children:" • "}),(0,R.jsx)(_.ZP,{value:"/buddyfeed_artist",children:(0,R.jsx)(M._,{menu:q.artist?(0,R.jsx)(w.m,{uri:q.artist.uri}):null,children:(0,R.jsx)(D.Link,{title:null===(m=q.artist)||void 0===m?void 0:m.name,to:null===(h=q.artist)||void 0===h?void 0:h.uri,className:"ellipsis-one-line",dir:"auto",draggable:!0,onDragStart:ge,onClick:function(){var e;return ve("artist_link",null===(e=q.artist)||void 0===e?void 0:e.uri)},children:null===(g=q.artist)||void 0===g?void 0:g.name})})})]}),(0,R.jsx)(N.D,{as:"p",variant:"finale",className:y()("ellipsis-one-line",re),children:(0,R.jsx)(_.ZP,{value:"/buddyfeed_context",children:(0,R.jsx)(M._,{menu:je(null===(x=q.context)||void 0===x?void 0:x.uri,null===(j=q.artist)||void 0===j?void 0:j.uri),children:(0,R.jsxs)(D.Link,{title:null===(p=q.context)||void 0===p?void 0:p.name,to:null===(S=q.context)||void 0===S?void 0:S.uri,className:ae,draggable:!0,onDragStart:xe,onClick:function(){var e;return ve("context_link",null===(e=q.context)||void 0===e?void 0:e.uri)},children:[(0,R.jsx)(F.t,{type:pe(fe),iconSize:16,className:ie}),(0,R.jsx)("span",{dir:"auto",className:"ellipsis-one-line",children:null===(E=q.context)||void 0===E?void 0:E.name})]})})})})]})]},Z.user.uri):null};function Ne(e){var n=e.friends,t=e.spec;return(0,R.jsx)(j.U5,{flipKey:n.map((function(e){return e.user.uri})).join(""),children:(0,R.jsx)("ol",{children:n.map((function(e,n){return(0,R.jsx)(j.$3,{flipId:e.user.uri,children:(0,R.jsx)("li",{children:(0,R.jsx)(ye,{friend:e,show:n<100,spec:t},e.user.uri)})},e.user.uri)}))})})}var ke=t(47071),Ce=t(42382),Se=t(29766),we=t(38076),Ee=t(57814),Ie=(t(33208),t(93019),t(17657)),Le=t(77330),Oe=(t(58549),t(24353),t(95442)),De=t(60980),Ae=t(12677),Te=t(44634);const Me="w5nHQ74JGTytKwWanjvB",Fe="u11kJflcqt7CSXo9qL_T",_e="MmENkh6tW0MyjTtTtPHZ",Pe="Gl0dkNQbAyNjVZ1IpghI";var Ue=function(e){var n=e.name,t=e.following,s=e.imageUrl,c=e.uri,l=(0,Ae.q)(),u=(0,v.o)(),d=r.createRef(),f=(0,r.useState)(t),m=(0,i.Z)(f,2),h=m[0],x=m[1];(0,Te.d)(De.rA.OPERATION_COMPLETE,(function(e){if(e.data.uris.includes(c))switch(e.data.operation){case De.BM.FOLLOW_USER:x(!0);break;case De.BM.UNFOLLOW_USER:x(!1)}}));var b=(0,r.useCallback)((function(){h?l.unfollowUsers([c]):(l.followUsers([c]),u({intent:"follow",type:"click",itemIdSuffix:"buddyfeed"})),d.current&&d.current.blur()}),[h,d,c,l,u]);return(0,R.jsxs)("div",{className:Me,children:[(0,R.jsx)(C.q,{label:n,width:40,userIconSize:16,images:(0,r.useMemo)((function(){return[{width:40,height:40,url:s}]}),[s])}),(0,R.jsxs)("div",{className:y()(Fe,"ellipsis-one-line"),children:[(0,R.jsx)(N.D,{as:"p",variant:"mestoBold",className:"ellipsis-one-line",children:n}),h&&(0,R.jsx)(N.D,{as:"p",variant:"finale",className:"ellipsis-one-line",children:o.ag.get("following")})]}),(0,R.jsx)("div",{className:_e,children:(0,R.jsx)(g.E,{className:Pe,size:"sm",ref:d,onClick:b,ariaLabel:h?o.ag.get("buddy-feed.button.remove-friend"):o.ag.get("buddy-feed.button.add-friend"),icon:h?Oe.k:a.t})})]})};const Be="nGInMrf62TCFD9MBnEzz";function Ze(e){var n=e.facebookFriends;return(0,R.jsx)("div",{className:Be,children:n.map((function(e){var n=e.uri,t=e.following,i=e.title,r=e.image;return(0,R.jsx)(Ue,{uri:n,name:i,imageUrl:r,following:t},"fb-friend-".concat(n))}))})}t(90129);var ze=t(74140);const Re="n6rSk6R7nfmSGSgTRR5_";function Je(){return(0,R.jsx)("div",{className:Re,children:Array(20).fill(0).map((function(e,n){return(0,R.jsx)(ze.C,{isLoading:!0,charCount:100,as:"p",variant:"canon"},n)}))})}var Ye=t(88769),He=t(26533),Ke=t.n(He),qe=(t(41631),t(66608),t(85675),t(59689)),We=t(34768);const Qe="pZFwflwH1vXVCmAO5vbz",Ve="yPL55nV5rC97vJhAf7ke",Ge="qpgo9DQ9rVZbO5pLJog5",Xe="A3hvkJOGkBNa6zWj6oZa",$e="pIyez6N1SF3jW0U5VUx4",en="lIxuZR4lYTrEKkMYedty",nn="VEmC3OHK3uAasHvO5OuA",tn="wzGPtuvvLpOpY1PDu4Qv",rn="YoJTUV4hazVCFNbfKoNq";var an,sn=function(e){var n,t,a,s,c,l,u=e.onBackButtonClick,d=(0,r.useState)(""),f=(0,i.Z)(d,2),m=f[0],v=f[1],h=(n=m,a=(0,We.I)(),s=n.trim().toLowerCase(),c=(0,qe.useQuery)("useFacebookFriends",(0,Ye.Z)(Ke().mark((function e(){var n;return Ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.fetchFacebookFriends();case 2:return n=e.sent,e.abrupt("return",n.sort((function(e,n){return e.title>n.title?1:-1})));case 4:case"end":return e.stop()}}),e)})))),l=c.data,{isLoading:c.isLoading,friends:null!==(t=null==l?void 0:l.filter((function(e){return-1!==e.title.trim().toLowerCase().indexOf(s)})))&&void 0!==t?t:[]}),x=h.isLoading,b=h.friends,j=(0,Ie.y1)((function(e){v(e.target.value)}),100),p=(0,r.useCallback)((function(e){null!==e&&e.focus()}),[]);return(0,R.jsxs)("div",{className:Qe,children:[(0,R.jsx)(g.E,{ariaLabel:o.ag.get("buddy-feed.button.back"),onClick:u,ref:p,className:Ve,icon:ke.e,size:"sm",testId:"back-to-friends"}),(0,R.jsxs)("div",{className:Ge,children:[(0,R.jsx)("div",{className:Xe,children:(0,R.jsx)(Se.z,{className:$e,iconSize:32})}),(0,R.jsx)("div",{className:en,children:x?(0,R.jsx)(ze.C,{isLoading:!0,charCount:25,as:"p",variant:"mesto"}):(0,R.jsx)(N.D,{as:"p",variant:"mesto",children:o.ag.get("buddy-feed.number-of-friends",b.length)})})]}),x?(0,R.jsx)(Je,{}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{className:nn,children:[(0,R.jsx)(Le.j,{className:rn,iconSize:16,role:"presentation"}),(0,R.jsx)("input",{onChange:j,className:tn,placeholder:o.ag.get("buddy-feed.find-in-playlists")})]}),(0,R.jsx)(Ze,{facebookFriends:b})]})]})},cn=t(21599);function on(e){var n=e.isOpen,t=e.onClose,i=e.onConfirm;return(0,R.jsx)(cn.Q,{onClose:t,"aria-label":o.ag.get("web-player.buddy-feed.connect-with-facebook-title"),onConfirm:i,titleText:o.ag.get("web-player.buddy-feed.connect-with-facebook-title"),descriptionText:o.ag.get("web-player.buddy-feed.connect-with-facebook-description"),cancelText:o.ag.get("queue.cancel-button"),confirmText:o.ag.get("web-player.buddy-feed.connect-button"),isOpen:n})}!function(e){e[e.LOADING=0]="LOADING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED"}(an||(an={}));const ln="EmZCbU1_B_J9RAHebolL",un="Ym6Yyx83U7mNKOMw9dxw",dn="NXcZaSipzomJ6d4_nM94",fn="b9rqRkvRvhrSY4FYHQVC",mn="xHc_2FQr3NxfCgfDSVhY",vn="QAJYN0xWh3h2A5d8_C1g",hn="PKhH1CknobkjJdVITsb4",gn="HgRmCE3NxfiYNtv6pF3H",xn="HnA5mipUMkheAlbxqCn_",bn="mvp0xhvZTo0xv0TIwi9u";var jn=function(e){var n=(0,v.o)(),t=e.onBackButtonClick,a=e.feedIsEmpty,s=e.goToAddFriends,c=void 0!==s&&s,l=function(){var e=(0,We.I)(),n=(0,r.useState)(an.LOADING),t=(0,i.Z)(n,2),a=t[0],s=t[1];return(0,r.useEffect)((function(){return e.subscribeToFacebookConnectionState((function(e){s(e.connection?an.CONNECTED:an.DISCONNECTED)})).cancel}),[e]),a}(),u=(0,We.I)(),d=(0,r.useState)(!1),f=(0,i.Z)(d,2),m=f[0],h=f[1],x=(0,r.useState)(!1),b=(0,i.Z)(x,2),j=b[0],p=b[1],y=(0,r.useState)(!1),k=(0,i.Z)(y,2),C=k[0],S=k[1],w=(0,r.useCallback)((function(e){null!==e&&e.focus()}),[]),E=(0,r.useCallback)((function(){location.reload()}),[]);if(j)return(0,R.jsxs)("div",{className:xn,children:[(0,R.jsx)(g.E,{onClick:t,ref:w,className:dn,ariaLabel:o.ag.get("buddy-feed.button.back"),icon:ke.e,size:"sm"}),(0,R.jsxs)("div",{className:bn,children:[(0,R.jsx)(N.D,{as:"h1",variant:"balladBold",className:un,children:o.ag.get("error-dialog.generic.header")}),(0,R.jsx)(N.D,{as:"p",variant:"mesto",className:fn,children:o.ag.get("error-dialog.generic.body")}),(0,R.jsx)(Ce.D,{colorSet:"invertedLight",onClick:E,children:o.ag.get("error.reload")})]})]});var I=(c||C)&&l===an.CONNECTED;return(0,R.jsxs)("div",{className:ln,children:[I&&(0,R.jsx)(sn,{onBackButtonClick:function(){a&&S(!1),t()}}),!I&&(0,R.jsxs)("div",{className:vn,children:[(0,R.jsx)(g.E,{ariaLabel:o.ag.get("buddy-feed.button.back"),onClick:t,className:dn,ref:w,icon:ke.e,size:"sm"}),(0,R.jsx)(N.D,{as:"h1",variant:"balladBold",className:un,children:o.ag.get("buddy-feed.friend-activity")}),(0,R.jsx)(N.D,{as:"p",variant:"mesto",className:fn,children:o.ag.get("buddy-feed.facebook.connect-with-friends-default")}),(0,R.jsx)("div",{className:hn,children:(0,R.jsx)(Ce.D,{className:gn,buttonSize:"sm",iconLeading:Se.z,UNSAFE_colorSet:(0,we.Ev)("#2374E1",Ee.$_Y.white),onClick:function(){n({intent:"connect-to-facebook",type:"click",itemIdSuffix:"buddyfeed"}),l!==an.CONNECTED?h(!0):S(!0)},children:o.ag.get("buddy-feed.facebook.button")})}),(0,R.jsx)(N.D,{as:"p",variant:"finale",className:mn,children:o.ag.get("buddy-feed.facebook.disclaimer")}),(0,R.jsx)(on,{isOpen:m,onClose:function(){h(!1)},onConfirm:function(){u.connectToFacebook().then((function(){S(!0),h(!1)})).catch((function(){p(!0)}))}})]})]})},pn=t(76229),yn=t(88590),Nn=function(e){var n=e.showOnlineIndicator;return(0,R.jsxs)("div",{className:ue,children:[(0,R.jsxs)("div",{className:de,children:[(0,R.jsx)(yn.f,{iconSize:24}),n?(0,R.jsx)("div",{className:fe}):null]}),(0,R.jsxs)("div",{className:me,children:[(0,R.jsx)("div",{className:y()(ve,he)}),(0,R.jsx)("div",{className:ve}),(0,R.jsx)("div",{className:ve})]})]})},kn=function(){return(0,R.jsxs)("div",{"data-testid":"buddy-feed-empty-state",className:oe,children:[(0,R.jsx)(N.D,{as:"p",className:le,children:o.ag.get("buddy-feed.let-followers-see-your-listening")}),(0,R.jsx)(Nn,{showOnlineIndicator:!0}),(0,R.jsx)(Nn,{showOnlineIndicator:!0}),(0,R.jsx)(Nn,{}),(0,R.jsx)(N.D,{as:"p",className:le,children:o.ag.get("buddy-feed.enable-share-listening-activity")}),(0,R.jsx)(pn.rU,{to:"/preferences",className:ge,children:(0,R.jsx)(Ce.D,{colorSet:"invertedLight",className:xe,children:o.ag.get("desktop.settings.settings")})})]})},Cn=t(90092),Sn=t(61141);const wn="jUF2eKgYMm64aYykubct",En="zhL_lhJqzKfJVy7L5VuY",In="XqquM_o2eODcnD8Y4QhS",Ln="UGtycHBJ4egymBSmD_lX",On="ND2ydDPzwQZB7HyaGCN8",Dn="D9YN554UFGJle2CPP1TA",An="v7Zcy9UKVUTDZIMKB6ZF",Tn="RX3U6eAasqazEkuFdnj0";var Mn=function(e){var n=e.children,t=e.page,i=0===t,r=n.filter((function(e,n){return n!==t}));return(0,R.jsx)(Cn.Z,{component:null,children:r.map((function(e){return(0,R.jsx)(Sn.Z,{in:i,timeout:500,classNames:{enter:i?wn:On,enterActive:i?En:Dn,exit:i?In:An,exitActive:i?Ln:Tn},children:e},i?"first-page":"second-page")}))})},Fn=(t(2840),t(6201),t(3761),t(81049),t(26870),t(53987),t(27676),t(84437),t(43316),t(73630),t(27586),t(15970),t(56110),t(7232),t(46220));t(66410);function _n(e){return e.sort((function(e,n){return n.timestamp-e.timestamp}))}function Pn(e,n){return n.some((function(n){return n.user.uri===e.user.uri}))?n:_n([].concat((0,Fn.Z)(n),[e]))}function Un(e,n){return n.filter((function(n){return n.user.uri!==e}))}t(73566),t(98618),t(40905),t(86720);function Bn(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(!e)return;if("string"==typeof e)return Zn(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Zn(e,n)}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==t.return||t.return()}finally{if(c)throw a}}}}function Zn(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function zn(e){var n=(0,We.I)(),t=(0,r.useState)(_n(e)),a=(0,i.Z)(t,2),s=a[0],c=a[1],o=function(e,n){var t=(0,We.I)(),i=(0,r.useRef)(e),a=(0,r.useRef)({}),s=(0,r.useRef)(n);s.current=n;var c=(0,r.useCallback)((function(e){var n,i=null===(n=(0,k.EC)(e))||void 0===n?void 0:n.username;return t.subscribeToBuddyActivity(i,(function(e){e&&s.current(e)}))}),[t]),o=(0,r.useCallback)((function(e){var n;null===(n=a.current[e])||void 0===n||n.cancel(),delete a.current[e]}),[]);return(0,r.useEffect)((function(){a.current=i.current.reduce((function(e,n){var t=n.user.uri,i=c(t);return e[t]=i,e}),{})}),[c]),(0,r.useEffect)((function(){var e=a.current;return function(){Object.values(e).forEach((function(e){e.cancel()}))}}),[]),{subscribeToFriend:c,unSubscribeFromFriend:o}}(e,(function(e){c((function(n){return function(e,n){return _n(n.map((function(n){return n.user.uri===e.user.uri?e:n})))}(e,n)}))})),l=o.subscribeToFriend,u=o.unSubscribeFromFriend;return(0,Te.d)(De.rA.OPERATION_COMPLETE,function(){var e=(0,Ye.Z)(Ke().mark((function e(t){var i,r,a,o,d,f,m;return Ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.data.uris,t.data.operation!==De.BM.FOLLOW_USER){e.next=19;break}r=Bn(i),e.prev=3,o=Ke().mark((function e(){var t,i,r;return Ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.value,s.find((function(e){return e.user.uri===t}))){e.next=8;break}return e.next=4,n.fetchFriendActivity([t]);case 4:i=e.sent,r=i[0],c((function(e){return Pn(r,e)})),l(t);case 8:case"end":return e.stop()}}),e)})),r.s();case 6:if((a=r.n()).done){e.next=10;break}return e.delegateYield(o(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),r.e(e.t1);case 15:return e.prev=15,r.f(),e.finish(15);case 18:return e.abrupt("return");case 19:if(t.data.operation===De.BM.UNFOLLOW_USER){d=Bn(i);try{for(m=function(){var e=f.value;s.find((function(n){return n.user.uri===e}))&&(u(e),c((function(n){return Un(e,n)})))},d.s();!(f=d.n()).done;)m()}catch(e){d.e(e)}finally{d.f()}}case 20:case"end":return e.stop()}}),e,null,[[3,12,15,18]])})));return function(n){return e.apply(this,arguments)}}()),s}const Rn=function(e){var n=e.initialFriends,t=e.className,j=(0,v.o)(),p=(0,l.n)(),y=zn(n),N=(0,b.$P)(),k=(0,b.fU)(c.createDesktopFriendActivityEventFactory,{}).spec;(0,r.useEffect)((function(){j({intent:"view",type:"impression",itemIdSuffix:"buddyfeed"})}),[j]);var C=(0,r.useState)(!1),S=(0,i.Z)(C,2),w=S[0],E=S[1],I=function(){w||N.logInteraction(k.addFriendButtonFactory().hitUiReveal()),E(!w)},L=0===y.length,O=(0,r.useCallback)((function(){N.logInteraction(k.closeButtonFactory().hitUiHide())}),[N,k]);return(0,R.jsx)(x.DJ.Provider,{value:"buddy_feed",children:(0,R.jsx)(u.l,{label:o.ag.get("buddy-feed.friend-activity"),className:t,children:(0,R.jsxs)(Mn,{page:w?1:0,children:[(0,R.jsx)("div",{className:q,children:(0,R.jsx)(jn,{onBackButtonClick:I,feedIsEmpty:L,goToAddFriends:w})}),(0,R.jsxs)("div",{className:W,children:[(0,R.jsxs)(d.K,{children:[(0,R.jsx)(f.V,{title:o.ag.get("buddy-feed.friend-activity"),panel:m.s.BuddyFeed,onClose:O,actions:!p&&(0,R.jsx)(h._,{label:o.ag.get("buddy-feed.add-friends"),children:(0,R.jsx)(g.E,{ariaLabel:o.ag.get("buddy-feed.add-friends"),testId:"add-friends-button",size:"sm",onClick:I,icon:a.t})})}),(0,R.jsx)("div",{className:se,children:(0,R.jsx)(g.E,{ariaLabel:o.ag.get("buddy-feed.add-friends"),className:ce,size:"sm",onClick:I,icon:a.t})}),L?(0,R.jsx)(kn,{}):(0,R.jsx)(Ne,{friends:y,spec:k})]}),p&&(0,R.jsx)("div",{className:H,children:(0,R.jsx)(s.P,{className:K,"data-testid":"add-friends-button",buttonSize:"sm",onClick:I,title:o.ag.get("buddy-feed.find-friends"),children:o.ag.get("buddy-feed.find-friends")})})]})]})})})}}}]);
//# sourceMappingURL=xpui-routes-buddy-feed.js.map